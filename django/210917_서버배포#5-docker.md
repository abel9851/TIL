# 서버배포 #5 - docker

- ## dockerfile 만들기

dockerfile은 개발환경에서 만들자.  

우선 python 3.9.1을 받아야할듯 

도커에서 포트 80:80의 의미는,  
앞의 80은 인스턴스, 뒤의 80은 컨테이너를 뜻한다.  
즉, 호스트(인스턴스) 80번포트와 컨테이너 80번 포트를 연결한다는 것으로  
클라이언트가 example.com:80으로 접근하면  
example.com:80의 80은 호스트(인스턴스)의 80이다.  
그 80번 포트는 컨테이너 80번포트로 연결되어 있기때문에  
요청은 80번 포트를 사용하는 컨테이너로 가게 된다.  
즉 클라이언트의 80번포트요청 -> 호스트(인스턴스)의 포트가 80번이 열려있으면 그 80번포트로 요청을 받음  
-> 호스트(인스턴스)의 80번 포트는  특정 컨테이너의 80번포트와 연결되어 있으니  
컨테이너에 요청이 전달된다.  
이렇게 연결된 포트로 신호를 전달하는 것을  
**포트 포워딩(port forwarding)이라고 한다**  

- ## 장고 컨테이너 만들기  
    1. 깃허브에 소스 업로드 하기  
   서버에, 도커를 이용하여 장고 컨테이너를 만드려면  
   우선 깃허브에 소스코드를 올려야한다.  

   이 작업에서 아주 중요한 작업이 있는데  
   현재 장고 프로젝트는 가상환경인 pipenv에서 여러가지 패키지를 설치하고 만든 상태이다.  
   (django-environ, django-dotenv 등은 따로 환경변수를 .env 파일을 통해 관리하기 위해 설치한 것이다.)  
   (django-environ, django-dotenv 둘 중 하나만 있어도 된다.)  

   서버에서도 같은 패키지를 설치해줘야 움직임으로 패키지, 라이브러리 리스트를 만들어야한다.  
   `pipenv run pip freeze > requirements.txt`를 사용해서 requirements.txt를 만들고  
   이를 깃허브에 올리자.  
   requirements.txt 파일 하나로도 같은 가상환경을 구축할 수 있다.  
   ]그리고 도커의 컨테이너는 하나의 격리된 공간이기 때문에  
   굳이 pipenv를 설치해서 가상환경을 구축해줄 필요가 없을 듯 하다.  
   

        의문점:
        현재 장고프로젝트에서 gulp은 tailwindcss와, scss->css 변환을 위해 설치했던 상태인데  
        이를 배포환경에서도 설치할 필요가있나?(package.json)
        
        무엇보다 npm run css로 gulp을 통해 설치했던 tailwindcss로
        작성했던 scss파일은, css로 변환되어 따로 파일에 저장되어 있는 상태이다  
        그러니까 즉, css가 앱에 적응되어 있는 상태에서 소스코드를 올리는 것인데  
        굳이 배포환경에서 gulp, gulpfile, package.json에 있는 패키지들을 설치할 필요가 있을까? 
        
        찾아보고 결정하자.  


    2. 도커 파일 작성
    3. 도커 이미지 빌드
    4. 컨테이서 RUN