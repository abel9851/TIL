# 쿠키, 세션, 캐시

- 쿠키란?

  쿠키는 웹사이트 접속시 접속자의 개인장치에 다운로드 되고 브라우저에 저장되는 작은 텍스트 파일이다.  
  웹사이트는 쿠키를 통해 접속자의 장치를 인식하고, 접속자의 설정과 과거 이용내역에 대한 일부 데이터를 저장한다.  
  쿠키(기록파일)에 담긴 정보는 인터넷 사용자가 같은 웹사이트를 방문할 때 마다 읽히고  
  수시로 새로운 정보로 바뀐다.  
  쿠키는 소프트웨어가 아니다. 컴퓨터 내에서 프로그램처럼 실행될 수 없으며 바이러스를 옮길 수도  
  악성코드를 설치할 수도 없다. 하지만 스파이웨어를 통해 유저의 브라우징 행동을 추적하는데에  
  사용될 수 있고, 누군가의 쿠키를 훔쳐서 해당 사용자의 웹 계정 접근권한을 획득 할 수도 있다.

  웹서버가 웹 브라우저에게 보내어 저장했다가 서버의 부가적인 요청이 있을 떄 다시 서버로 보내주는 문자열 정보,  
  웹사이트 방문시 방문 기록 등 브라우저에서의 정보들이 저장된 텍스트 파일..

일반적으로 쿠키에는 만료일이 있다.  
브라우저를 닫는 경우 자동으로 삭제되는 쿠키도 있고(세션 쿠키),  
수동으로 삭제되기전까지 남아있는 등, 오랜기간 동안 컴퓨터에 저장되는 쿠키도 있다.(지속적 쿠키)

웹에서 요청마다 매번 연결과 해제가 되면서 새로운 사용자로 인식되는 단점이 있지만  
쿠키와 세션을 통해 브라우저를 종료했다가 다시 접속해도 그 로그인 상태를 유지할 수 있다.  
**즉, 쿠키는 서버를 대신해 웹 브라우저에 저장하고 요청을 할 때**  
**그정보를 서버에 보내 사용자를 식별할 수 있게 한다.**

**쿠키는 세션관리, 개인화, 트래킹에 사용되며, 세션은 쿠키를 이용한다.**
**웹 브라우저가 서버에 요청을 하면 서버는 세션 아이디를 할당해서 응답할 때 함께 전달한다.**

쿠키는 서버가 사용자의 웹 브라우저에 저장하며  
데이터형태는 Key, Value형태로 string문이며, 4kb이상 저장이 불가능하다.  
브라우저마다 저장되는 쿠키는 다르다.(크롬, 사파리 등 각각 다르다)

- 쿠키종류

1.  기술적 쿠키: 검색하는 주체가 사람인지 아니면 어플리케이션이지 이용자 구분 기능 수행
2.  분석 쿠키: 어떤 종류를 검색하는지, 많이 검색하는지, 시간, 언어 대상 등의 정보를 수집
3.  광고 쿠키: 검색 내용, 국가, 언어에 따라 광고를 게재  
    일반적으로 Session 쿠키는 웹 브라우저가 종료될 때 제거되는 쿠키다.

그 밖의 쿠키 사용방법 참조[쿠키](https://lovefor-you.tistory.com/24)

- 쿠키용도

쿠키로 인하여 페이지 이동시 마다 로그인을 다시하지 않고, 사용자 정보를 유지할 수 있다.  
쿠키가 없다면 해당 사용자 정보 파라미터를 계속 페이지마다 넘겨줘야한다.

1. ID 정보 저장 -> 로그인 상태 유지
2. 최근 검색한 정보 광고 추천
3. 쇼핑몰 장바구니 저장 기능
4. 3일간, 7일간 등 일정기간 다시보지 않기 체크(쿠키 날짜 기록 계산)

- 세션이란?

쿠키에다가 저장하기에는 민감한,곤란한 정보(얼마짜리 서비스를 이용했는지, 회원으로 입장해있는지 등등 )를 세션(서버측)에 저장한다.  
그 정보들이 누구의 것인지는 쿠키에 Session ID(바코드와 유사하다)를 통해 구분한다.  
세션을 사용하는 서비스에 접속하면 사용자를 구분하기 위한 기한이 짦은 임시 키 하나를 브라우저에 보내서 쿠키로 저장한다.  
사용자가 웹사이트를 돌아다닐때 사용자의 중요한 정보들은 **서버의 메모리나 데이터베이스에 저장된다.(세션아이디 파일? 세션아이디 파일도 서버의 메모리 위에 있긴 하겠지만..)**  
브라우저가 이 사이트의 페이지들에 접속할 때 마다 http요청에 이 임시키가 담긴 쿠키를 실어서 전송하고  
서버는 그 임시키를 보고 이 사용자가 그 사용자구나 인식해서 사용자의 정보들을 가공해서 응답으로 보내준다.  
내가 네이버에 로그인한 다음, 네이버의 다른 페이지들을 이용할 때마다 새로 로그인을 할 필요가 없는 것은  
쿠키와 세션의 조합으로 내 컴퓨터에서 네이버에 로그인해 있다는 것을 네이버의 서버가 인지하고 있기 때문이다.

네이버에 속한 모든 쿠키를 지우면 새로고침을 누르면 로그인이 해제되어있다.  
서버에서는 세션에 내 로그인 정보를 가지고 있지만 그게 내거라는 걸 증명할 세션아이디가  
내 쿠키 보관함에서 지워졌기 때문이다.

**즉 세션이란 일정시간동안 같은 사용자(정확하게 브라우저를 말한다)로부터 들어오는**  
**일련의 요구를 하나의 상태로 보고 그 상태를 일정하게 유지시키는 기술이다.**  
또한 여기서 일정시간이란 방문가자 웹브라우저를 통해 웹서버에 접속한 시점으로부터 웹브라우저를 종료함으로써  
연결이 끝나는 시점을 말하며  
즉, 방문자가 웹서버에 접속해 있는 상태를 하나의 단위로 보고 **세션**이라고 칭하는 거다.

**쿠키는 특정 웹사이트를 방문했을 때 만들어지는 정보를 담는 파일을 지칭하는 것이며 상태 정보를 유지하는 기술이다.**

비교하자면,

쿠키의 경우는 방문자의 정보를 **방문자 컴퓨터의 메모리에 저장하는 것**을 말한다.  
예를 들자면 ID나 비밀번호를 저장하거나 방문한 사이트를 저장하는데에 사용한다.

세션은 방문자의 요청에 따른 정보를 방문자 메모리에 저장하는것이 아닌 **웹서버가 세션 아이디 파일을 만들어**  
서비스가 돌아가고 있는 서버에 저장하는 것을 말한다.

**즉, 프로세스들 사이에서 통신을 하기 위해 메시지 교환을 통해 서로를 인식한 이후부터 통신을 마칠때 까지의**  
**기간동안 서버에 잠시 방문자 정보를 저장하는게 세션이다.**  
세션은 서버에 처리를 요구하는 부하와 저장 공간을 필요로 한다.

google 페이지는 접속시 마다 로그인 상태를 유지한다.  
이는 쿠키를 통해서 사용자의 로그인ID, 비밀번호를 쿠키에 저장하게 된다.  
페이지 이동 시에 쿠키를 통해 로그인 정보를 서버에 전달하고,  
서버에서는 해당 사용자를 식별하여 로그인 상태를 유지할 수 있다.

다만 이 방식은 쿠키가 노출되어 보안 상 문제가 있기 때문에 이를 방지하기 위해 세션이 있다.  
세션은 비밀번호와 같이 인증정보를 쿠키에 저장하지 않고  
사용자의 식별자인 JSESSIONID(session id)로 저장한다.

서버에서는 인증정보와 같이 이 ID에 해당하는 로그인상태, 시간, 닉네임, 만료기한 등 정보를 저장한다.  
서버는 해당 세션ID로 정보를 관리하기 때문에 보안상 훨씬 더 안전하다.

- 세션 동작 원리

1. 클라이언트: 서버에 Request 요청(Session ID 미존재)
2. 서버: 클라이언트로 Session ID 쿠키 값 체크 후 없을 경우, 새로 생성해서 응답
3. 클라이언트는 전달받은 Session ID 값을 매 용청마다 Header 쿠키에 담아서 전달
4. 서버는 Session ID로 시용자 식별
5. 클라이언트가 로그인 요청 시 서버에서는 session을 로그인한 사용자 정보로 갱신하고, 새로운 Session ID를 발급하여 응답
6. 클라이언트가 이후에 사용자의 session ID 쿠키를 요청과 함께 전달하고, 서버에서도 해당 로그인 사용자로 식별
7. 클라이언트 종료(브라우저 종류)시, Session ID 제거, 서버에서도 Session 제거

- 캐시란?

웹 뿐만아니라 안드로이드나 다른데에서도 쓰이는데  
가져오는데 비용이 드는 데이터를 한번 가져온 뒤에는 임시로 저장해두는 것이다.  
웹 캐시는, 이미지 등의 정보를 불러올 때 데이터 사용량도 발생하고 시간도 들기 때문에  
사용자가 여러 번 방문할 법한 사이트에서는 한번 받아온 데이터를 사용자의 컴퓨터 또는 중간 역할을 하는 서버에 저장해두는 것이다.
